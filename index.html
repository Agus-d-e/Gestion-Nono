<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C.A.I.A - Taller</title>
  <style>
    /* Reset y base */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background-color: #0f0f0f;
      color: #f5f5f5;
      line-height: 1.6;
    }

    /* Estilos para la p√°gina de inicio */
    body.landing {
      background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .center-box {
      text-align: center;
      background: #1a1a1a;
      padding: 30px 20px;
      border-radius: 15px;
      border: 2px solid #ff9800;
      box-shadow: 0 0 25px rgba(255, 153, 0, 0.3);
      width: 100%;
      max-width: 400px;
    }

    .center-box h1 {
      color: #ff9800;
      font-size: 2.5em;
      margin-bottom: 15px;
    }

    .center-box p {
      font-size: 1.1em;
      margin-bottom: 25px;
      color: #ffb84d;
    }

    .btn {
      display: inline-block;
      background-color: #ff9800;
      color: #000;
      padding: 12px 30px;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      font-size: 1em;
    }

    .btn:hover {
      background-color: #ffa733;
      transform: scale(1.05);
    }

    /* Ocultar la gesti√≥n inicialmente */
    #gestion-container {
      display: none;
    }

    /* Estilos para el sistema de gesti√≥n */
    body:not(.landing) {
      background-color: #0f0f0f;
      padding: 0;
    }

    /* üè∑Ô∏è Header */
    header {
      background-color: #151515;
      border-bottom: 2px solid #ff9800;
      padding: 15px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .header-main {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      width: 100%;
    }

    header h1 {
      color: #ff9800;
      font-size: 1.5em;
      text-align: center;
      margin: 0;
    }

    .header-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .header-btn {
      background: #666;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
      white-space: nowrap;
    }

    .header-btn.alert {
      background: #ff4444;
    }

    /* üì¶ Panel selector y filtros */
    #panel {
      margin: 20px;
      background: #1a1a1a;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 153, 0, 0.3);
      border: 1px solid #ff9800;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    .panel-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: end;
    }

    .filtro-group {
      flex: 1;
      min-width: 200px;
    }

    #panel label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #ffb84d;
      font-size: 1.1em;
    }

    #selector, .filtro-input, .filtro-select {
      background-color: #222;
      color: #fff;
      border: 1px solid #ff9800;
      border-radius: 6px;
      padding: 10px;
      width: 100%;
      font-size: 1em;
    }

    .btn-filtro {
      background: #ff9800;
      color: #000;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      white-space: nowrap;
      font-size: 0.9em;
    }

    .btn-filtro:hover {
      background: #ffa733;
    }

    /* üìù Formulario */
    #form-section {
      background: #1a1a1a;
      margin: 20px;
      padding: 20px;
      border-radius: 15px;
      border: 1px solid #ff9800;
      box-shadow: 0 0 25px rgba(255, 153, 0, 0.15);
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    #form-section h2 {
      color: #ff9800;
      margin-bottom: 20px;
      text-align: center;
      font-size: 1.3em;
    }

    #formulario {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    #formulario label {
      color: #ffb84d;
      font-weight: bold;
      margin-bottom: 5px;
    }

    #formulario input, 
    #formulario select, 
    #formulario textarea {
      background-color: #222;
      border: 1px solid #ff9800;
      border-radius: 6px;
      color: #fff;
      padding: 12px;
      font-size: 1em;
      width: 100%;
    }

    #formulario textarea {
      min-height: 80px;
      resize: vertical;
    }

    #formulario button {
      margin-top: 10px;
      background-color: #ff9800;
      border: none;
      padding: 12px;
      color: #000;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      font-size: 1em;
    }

    #formulario button:hover {
      background-color: #ffa733;
    }

    /* üìä Tabla - Responsive */
    #crud-container {
      margin: 20px;
      overflow-x: auto;
      background: #1a1a1a;
      border-radius: 15px;
      border: 1px solid #ff9800;
      box-shadow: 0 0 25px rgba(255, 153, 0, 0.15);
      padding: 15px;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }

    th, td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid #333;
      white-space: nowrap;
    }

    th {
      background-color: #222;
      color: #ffb84d;
      font-weight: bold;
      position: sticky;
      top: 0;
    }

    td {
      color: #f5f5f5;
    }

    tr:hover {
      background-color: #2a2a2a;
    }

    .alerta-service {
      background-color: #ff4444 !important;
      color: white !important;
      font-weight: bold;
    }

    .alerta-service:hover {
      background-color: #cc3333 !important;
    }

    /* Botones de acci√≥n en tabla */
    .acciones-cell {
      white-space: nowrap;
    }

    .btn-accion {
      background: #ff9800;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      margin: 2px;
      font-size: 0.8em;
      min-width: 60px;
    }

    .btn-accion.eliminar {
      background: #ff4444;
    }

    .btn-accion:hover {
      transform: scale(1.05);
      opacity: 0.9;
    }

    /* ü¶∂ Footer */
    footer {
      margin-top: 30px;
      padding: 20px;
      text-align: center;
      font-size: 0.9em;
      color: #888;
      border-top: 1px solid #222;
    }

    /* Modal de alertas */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
      padding: 20px;
      overflow-y: auto;
    }

    .modal-content {
      background-color: #1a1a1a;
      margin: 5% auto;
      padding: 20px;
      border: 2px solid #ff9800;
      border-radius: 15px;
      width: 100%;
      max-width: 500px;
      color: #f5f5f5;
      box-shadow: 0 0 25px rgba(255, 153, 0, 0.3);
      position: relative;
    }

    .modal-header {
      color: #ff9800;
      border-bottom: 1px solid #333;
      padding-bottom: 15px;
      margin-bottom: 15px;
    }

    .modal-header h2 {
      font-size: 1.3em;
    }

    .modal-alerta {
      background-color: #ff4444;
      color: white;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      border-left: 5px solid #ff9800;
      font-size: 0.9em;
    }

    .close {
      color: #aaa;
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      line-height: 1;
    }

    .close:hover {
      color: #ff9800;
    }

    /* Informaci√≥n responsive */
    .info-responsive {
      display: none;
      background: #333;
      color: #ffb84d;
      padding: 10px;
      margin: 10px 20px;
      border-radius: 8px;
      text-align: center;
      font-size: 0.9em;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Media Queries para Responsive */
    @media (max-width: 768px) {
      .center-box {
        padding: 25px 15px;
      }
      
      .center-box h1 {
        font-size: 2em;
      }
      
      .header-content {
        padding: 0 10px;
      }
      
      .header-main {
        flex-direction: column;
        text-align: center;
      }
      
      header h1 {
        font-size: 1.3em;
      }
      
      .header-buttons {
        width: 100%;
        justify-content: center;
      }
      
      .header-btn {
        flex: 1;
        min-width: 120px;
        text-align: center;
      }

      .panel-row {
        flex-direction: column;
      }

      .filtro-group {
        min-width: 100%;
      }
      
      #panel, #form-section, #crud-container {
        margin: 10px;
        padding: 15px;
      }
      
      th, td {
        padding: 8px 10px;
        font-size: 0.9em;
      }
      
      .btn-accion {
        padding: 5px 8px;
        font-size: 0.75em;
        min-width: 50px;
        margin: 1px;
      }
      
      .modal-content {
        margin: 10% auto;
        padding: 15px;
      }
      
      .info-responsive {
        display: block;
      }
    }

    @media (max-width: 480px) {
      .center-box h1 {
        font-size: 1.8em;
      }
      
      .center-box p {
        font-size: 1em;
      }
      
      .btn {
        padding: 10px 20px;
        font-size: 0.9em;
      }
      
      header {
        padding: 10px 15px;
      }
      
      .header-btn {
        font-size: 0.8em;
        padding: 6px 10px;
      }
      
      #formulario input, 
      #formulario select, 
      #formulario textarea {
        padding: 10px;
      }
      
      th, td {
        padding: 6px 8px;
        font-size: 0.85em;
      }
      
      table {
        min-width: 500px;
      }
    }

    /* Scrollbar personalizado */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #1a1a1a;
    }

    ::-webkit-scrollbar-thumb {
      background: #ff9800;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #ffa733;
    }
  </style>
</head>
<body class="landing">
  <!-- P√°gina de Inicio -->
  <div class="center-box" id="inicio-container">
    <h1>C.A.I.A</h1>
    <p>Bienvenido al Centro de Asistencia Integrativa Automotriz</p>
    <button class="btn" onclick="mostrarGestion()">Entrar al sistema</button>
  </div>

  <!-- Sistema de Gesti√≥n (oculto inicialmente) -->
  <div id="gestion-container">
    <header>
      <div class="header-content">
        <div class="header-main">
          <h1>‚öôÔ∏è Gesti√≥n del Taller</h1>
          <div class="header-buttons">
            <button class="header-btn" onclick="mostrarInicio()">‚Üê Volver</button>
            <button class="header-btn alert" onclick="verificarAlertasServices()">üö® Ver Alertas</button>
          </div>
        </div>
      </div>
    </header>

    <main>
      <!-- Informaci√≥n para m√≥viles -->
      <div class="info-responsive">
        üí° Desliza horizontalmente para ver toda la tabla en dispositivos m√≥viles
      </div>

      <section id="panel">
        <div class="panel-row">
          <div class="filtro-group">
            <label for="selector">Seleccionar tabla:</label>
            <select id="selector">
              <option value="clientes">Clientes</option>
              <option value="mecanico">Mec√°nicos</option>
              <option value="especialidad">Especialidades</option>
              <option value="service">Service</option>
            </select>
          </div>
          
          <!-- Filtros para Clientes -->
          <div class="filtro-group" id="filtro-clientes" style="display: none;">
            <label for="filtro-nombre">Filtrar por nombre:</label>
            <input type="text" id="filtro-nombre" class="filtro-input" placeholder="Buscar por nombre...">
          </div>
          <div class="filtro-group" id="filtro-vehiculo" style="display: none;">
            <label for="filtro-vehiculo-input">Filtrar por veh√≠culo:</label>
            <input type="text" id="filtro-vehiculo-input" class="filtro-input" placeholder="Buscar por veh√≠culo...">
          </div>
          
          <!-- Filtros para Mec√°nicos -->
          <div class="filtro-group" id="filtro-especialidad" style="display: none;">
            <label for="filtro-especialidad-select">Filtrar por especialidad:</label>
            <select id="filtro-especialidad-select" class="filtro-select">
              <option value="">Todas las especialidades</option>
            </select>
          </div>
          
          <div class="filtro-group">
            <label>&nbsp;</label>
            <button class="btn-filtro" onclick="aplicarFiltros()">üîç Aplicar Filtros</button>
          </div>
          <div class="filtro-group">
            <label>&nbsp;</label>
            <button class="btn-filtro" onclick="limpiarFiltros()">üóëÔ∏è Limpiar Filtros</button>
          </div>
        </div>
      </section>

      <section id="form-section">
        <h2 id="titulo-form">Agregar registro</h2>
        <form id="formulario"></form>
      </section>

      <section id="crud-container">
        <div class="table-container">
          <!-- La tabla se generar√° aqu√≠ din√°micamente -->
        </div>
      </section>
    </main>

    <footer>
      <p>Desarrollado con ‚ù§Ô∏è y Supabase</p>
    </footer>
  </div>

  <!-- Modal para alertas -->
  <div id="modal-alertas" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarModal()">&times;</span>
      <div class="modal-header">
        <h2>üö® Alertas de Services</h2>
      </div>
      <div id="contenido-alertas"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Variables globales
    let supabase;
    let intervaloAlertas;
    let datosOriginales = {};
    let filtrosActivos = {
      clientes: { nombre: '', vehiculo: '' },
      mecanico: { especialidad: '' }
    };

    // Funci√≥n para mostrar/ocultar las secciones
    function mostrarGestion() {
      document.getElementById('inicio-container').style.display = 'none';
      document.getElementById('gestion-container').style.display = 'block';
      document.body.classList.remove('landing');
      
      // Inicializar el sistema de gesti√≥n
      inicializarSistemaGestion();
    }

    function mostrarInicio() {
      document.getElementById('inicio-container').style.display = 'block';
      document.getElementById('gestion-container').style.display = 'none';
      document.body.classList.add('landing');
      
      // Detener las alertas cuando volvemos al inicio
      if (intervaloAlertas) {
        clearInterval(intervaloAlertas);
      }
    }

    function cerrarModal() {
      document.getElementById('modal-alertas').style.display = 'none';
    }

    // üö® SISTEMA DE ALERTAS PARA SERVICES
    async function verificarAlertasServices() {
      if (!supabase) {
        alert("El sistema no est√° inicializado. Entra primero al sistema de gesti√≥n.");
        return;
      }

      try {
        const { data: services, error } = await supabase
          .from("service")
          .select("*")
          .not("fecha", "is", null)
          .order("fecha", { ascending: true });

        if (error) throw error;

        const hoy = new Date();
        const alertas = [];

        services.forEach(service => {
          const fechaService = new Date(service.fecha);
          const diferenciaMs = hoy - fechaService;
          const diferenciaDias = diferenciaMs / (1000 * 60 * 60 * 24);
          
          // Alerta a los 365 d√≠as (1 a√±o) con margen de ¬±5 d√≠as
          if (diferenciaDias >= 360 && diferenciaDias <= 370) {
            const anosTranscurridos = (diferenciaDias / 365).toFixed(1);
            alertas.push({
              id: service.id,
              nombre: service.nombre,
              vehiculo: service.vehiculo,
              numero: service.numero,
              fecha: service.fecha,
              diasTranscurridos: Math.floor(diferenciaDias),
              anosTranscurridos: anosTranscurridos
            });
          }
        });

        // Mostrar alertas si las hay
        if (alertas.length > 0) {
          mostrarAlertasServices(alertas);
        } else {
          alert("‚úÖ No hay services que cumplan 1 a√±o actualmente.");
        }
        
        return alertas;
      } catch (error) {
        console.error("Error verificando alertas:", error);
        alert("Error al verificar alertas: " + error.message);
      }
    }

    function mostrarAlertasServices(alertas) {
      const modal = document.getElementById('modal-alertas');
      const contenido = document.getElementById('contenido-alertas');
      
      let html = '';
      
      if (alertas.length === 0) {
        html = '<p>‚úÖ No hay alertas en este momento.</p>';
      } else {
        html = `<p>üö® <strong>${alertas.length} service(s) cumplen o est√°n por cumplir 1 a√±o:</strong></p>`;
        
        alertas.forEach((alerta, index) => {
          const fechaFormateada = new Date(alerta.fecha).toLocaleDateString('es-ES');
          html += `
            <div class="modal-alerta">
              <strong>${index + 1}. ${alerta.nombre}</strong><br>
              üìû Tel√©fono: ${alerta.numero}<br>
              üöó Veh√≠culo: ${alerta.vehiculo}<br>
              üìÖ Fecha del service: ${fechaFormateada}<br>
              ‚è∞ Tiempo transcurrido: ${alerta.diasTranscurridos} d√≠as (${alerta.anosTranscurridos} a√±os)<br>
              <br>
              <strong>üìû CONTACTAR AL CLIENTE PARA NUEVO SERVICE</strong>
            </div>
          `;
        });
        
        html += `<p><strong>Acci√≥n requerida:</strong> Contactar a estos clientes para programar un nuevo service de mantenimiento.</p>`;
      }
      
      contenido.innerHTML = html;
      modal.style.display = 'block';
    }

    // üîç SISTEMA DE FILTRADO
    function mostrarFiltros(tabla) {
      // Ocultar todos los filtros primero
      document.getElementById('filtro-clientes').style.display = 'none';
      document.getElementById('filtro-vehiculo').style.display = 'none';
      document.getElementById('filtro-especialidad').style.display = 'none';

      // Mostrar filtros seg√∫n la tabla seleccionada
      if (tabla === 'clientes') {
        document.getElementById('filtro-clientes').style.display = 'block';
        document.getElementById('filtro-vehiculo').style.display = 'block';
      } else if (tabla === 'mecanico') {
        document.getElementById('filtro-especialidad').style.display = 'block';
        cargarEspecialidadesFiltro();
      }
    }

    async function cargarEspecialidadesFiltro() {
      try {
        const { data: especialidades, error } = await supabase
          .from("especialidades")
          .select("especialidad")
          .order("especialidad");

        if (error) throw error;

        const select = document.getElementById('filtro-especialidad-select');
        // Mantener la opci√≥n "Todas las especialidades"
        select.innerHTML = '<option value="">Todas las especialidades</option>';
        
        especialidades.forEach(esp => {
          const option = document.createElement("option");
          option.value = esp.especialidad;
          option.textContent = esp.especialidad;
          select.appendChild(option);
        });
      } catch (error) {
        console.error("Error cargando especialidades para filtro:", error);
      }
    }

    function aplicarFiltros() {
      const tablaActual = document.getElementById('selector').value;
      
      if (tablaActual === 'clientes') {
        filtrosActivos.clientes.nombre = document.getElementById('filtro-nombre').value.toLowerCase();
        filtrosActivos.clientes.vehiculo = document.getElementById('filtro-vehiculo-input').value.toLowerCase();
      } else if (tablaActual === 'mecanico') {
        filtrosActivos.mecanico.especialidad = document.getElementById('filtro-especialidad-select').value;
      }
      
      // Re-renderizar la tabla con los filtros aplicados
      renderTablaConFiltros(tablaActual);
    }

    function limpiarFiltros() {
      const tablaActual = document.getElementById('selector').value;
      
      if (tablaActual === 'clientes') {
        document.getElementById('filtro-nombre').value = '';
        document.getElementById('filtro-vehiculo-input').value = '';
        filtrosActivos.clientes.nombre = '';
        filtrosActivos.clientes.vehiculo = '';
      } else if (tablaActual === 'mecanico') {
        document.getElementById('filtro-especialidad-select').value = '';
        filtrosActivos.mecanico.especialidad = '';
      }
      
      // Re-renderizar la tabla sin filtros
      renderTablaConFiltros(tablaActual);
    }

    function filtrarDatos(tabla, datos) {
      if (tabla === 'clientes') {
        return datos.filter(item => {
          const cumpleNombre = !filtrosActivos.clientes.nombre || 
            item.nombre.toLowerCase().includes(filtrosActivos.clientes.nombre);
          const cumpleVehiculo = !filtrosActivos.clientes.vehiculo || 
            item.vehiculo.toLowerCase().includes(filtrosActivos.clientes.vehiculo);
          return cumpleNombre && cumpleVehiculo;
        });
      } else if (tabla === 'mecanico') {
        return datos.filter(item => {
          return !filtrosActivos.mecanico.especialidad || 
            item.especialidad === filtrosActivos.mecanico.especialidad;
        });
      }
      return datos;
    }

    // Sistema de Gesti√≥n - Todo el c√≥digo JavaScript integrado
    function inicializarSistemaGestion() {
      const SUPABASE_URL = "https://yhisjimuytbvahocmzum.supabase.co";
      const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InloaXNqaW11eXRidmFob2NtenVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5MjkzOTgsImV4cCI6MjA3ODUwNTM5OH0.STN1ug49Sy74W-y7Wo-tXfy__beqS9mKH-MG46ZGJvA";
      supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      // Mapeo de tablas reales y sus claves primarias
      const tablaMap = {
        clientes: { name: "clientes", pk: "id_cliente" },
        mecanico: { name: "mecanicos", pk: "id_mec" },
        especialidad: { name: "especialidades", pk: "especialidad" },
        service: { name: "service", pk: "id" }
      };

      // Campos de cada tabla
      const campos = {
        clientes: ["nombre", "vehiculo", "numero", "mecanico"],
        mecanico: ["nombre", "telefono", "especialidad"],
        especialidad: ["especialidad"],
        service: ["nombre", "vehiculo", "numero", "precio", "materiales", "fecha"]
      };

      const selector = document.getElementById("selector");
      const container = document.getElementById("crud-container");
      const form = document.getElementById("formulario");

      // Variable para controlar si estamos editando
      let editando = false;
      let registroEditando = null;
      let tablaActual = "";

      // üß± Renderizar formulario din√°mico
      async function renderFormulario(tabla) {
        form.innerHTML = "";
        editando = false;
        registroEditando = null;
        tablaActual = tabla;

        const tituloForm = document.getElementById("titulo-form");
        tituloForm.textContent = "Agregar registro";

        // Mostrar filtros correspondientes
        mostrarFiltros(tabla);

        // Caso especial para clientes - necesitamos mec√°nicos para el select
        if (tabla === "clientes") {
          await renderFormularioClientes();
          return;
        }

        // Caso especial para mec√°nicos - necesitamos especialidades para el select
        if (tabla === "mecanico") {
          await renderFormularioMecanico();
          return;
        }

        // Caso especial para service
        if (tabla === "service") {
          await renderFormularioService();
          return;
        }

        // Formulario normal para otras tablas
        campos[tabla].forEach(campo => {
          const label = document.createElement("label");
          label.textContent = campo.charAt(0).toUpperCase() + campo.slice(1);

          const input = document.createElement("input");
          input.name = campo;
          input.required = true;
          
          // Definir tipos de input seg√∫n el campo
          if (campo === "numero" || campo === "precio") {
            input.type = "number";
            if (campo === "precio") {
              input.step = "0.01";
              input.min = "0";
            }
          } else if (campo === "fecha") {
            input.type = "date";
          } else if (campo === "materiales") {
            input.type = "text";
            input.placeholder = "Lista de materiales separados por coma";
          } else {
            input.type = "text";
          }

          form.appendChild(label);
          form.appendChild(input);
        });

        const boton = document.createElement("button");
        boton.textContent = "Guardar";
        boton.type = "submit";
        form.appendChild(boton);

        form.onsubmit = crearSubmitHandler(tabla);
      }

      // üìã Formulario especial para clientes
      async function renderFormularioClientes() {
        // Obtener lista de mec√°nicos con sus especialidades
        const { data: mecanicos, error } = await supabase
          .from("mecanicos")
          .select("id_mec, nombre, especialidad")
          .order("nombre");

        if (error) {
          console.error("Error al cargar mec√°nicos:", error);
          alert("Error al cargar mec√°nicos: " + error.message);
          return;
        }

        // Campos del formulario de clientes
        const camposClientes = ["nombre", "vehiculo", "numero"];
        
        camposClientes.forEach(campo => {
          const label = document.createElement("label");
          label.textContent = campo.charAt(0).toUpperCase() + campo.slice(1);

          const input = document.createElement("input");
          input.name = campo;
          input.required = true;
          input.type = "text";

          form.appendChild(label);
          form.appendChild(input);
        });

        // Campo mec√°nico como select
        const labelMecanico = document.createElement("label");
        labelMecanico.textContent = "Mec√°nico";
        const selectMecanico = document.createElement("select");
        selectMecanico.name = "mecanico";
        selectMecanico.required = true;

        // Opci√≥n por defecto
        const optionDefault = document.createElement("option");
        optionDefault.value = "";
        optionDefault.textContent = "Selecciona un mec√°nico";
        selectMecanico.appendChild(optionDefault);

        // Opciones de mec√°nicos con nombre y especialidad
        mecanicos.forEach(mec => {
          const option = document.createElement("option");
          option.value = mec.id_mec; // Usar el ID num√©rico
          option.textContent = `${mec.nombre} - ${mec.especialidad}`;
          option.setAttribute('data-nombre', mec.nombre);
          selectMecanico.appendChild(option);
        });

        form.appendChild(labelMecanico);
        form.appendChild(selectMecanico);

        const boton = document.createElement("button");
        boton.textContent = "Guardar";
        boton.type = "submit";
        form.appendChild(boton);

        form.onsubmit = crearSubmitHandler("clientes");
      }

      // üìã Formulario especial para mec√°nicos con select de especialidades
      async function renderFormularioMecanico() {
        // Obtener lista de especialidades
        const { data: especialidades, error } = await supabase
          .from("especialidades")
          .select("especialidad")
          .order("especialidad");

        if (error) {
          console.error("Error al cargar especialidades:", error);
          alert("Error al cargar especialidades: " + error.message);
          return;
        }

        // Campos del formulario de mec√°nicos
        const camposMecanico = ["nombre", "telefono"];
        
        camposMecanico.forEach(campo => {
          const label = document.createElement("label");
          label.textContent = campo.charAt(0).toUpperCase() + campo.slice(1);

          const input = document.createElement("input");
          input.name = campo;
          input.required = true;
          input.type = "text";

          form.appendChild(label);
          form.appendChild(input);
        });

        // Campo especialidad como select
        const labelEspecialidad = document.createElement("label");
        labelEspecialidad.textContent = "Especialidad";
        const selectEspecialidad = document.createElement("select");
        selectEspecialidad.name = "especialidad";
        selectEspecialidad.required = true;

        // Opci√≥n por defecto
        const optionDefault = document.createElement("option");
        optionDefault.value = "";
        optionDefault.textContent = "Selecciona una especialidad";
        selectEspecialidad.appendChild(optionDefault);

        // Opciones de especialidades
        especialidades.forEach(esp => {
          const option = document.createElement("option");
          option.value = esp.especialidad;
          option.textContent = esp.especialidad;
          selectEspecialidad.appendChild(option);
        });

        form.appendChild(labelEspecialidad);
        form.appendChild(selectEspecialidad);

        const boton = document.createElement("button");
        boton.textContent = "Guardar";
        boton.type = "submit";
        form.appendChild(boton);

        form.onsubmit = crearSubmitHandler("mecanico");
      }

      // üìã Formulario especial para service con validaciones
      async function renderFormularioService() {
        // Campos del formulario de service
        const camposService = ["nombre", "vehiculo", "numero", "precio", "materiales", "fecha"];
        
        camposService.forEach(campo => {
          const label = document.createElement("label");
          label.textContent = campo.charAt(0).toUpperCase() + campo.slice(1);

          let input;
          
          if (campo === "materiales") {
            input = document.createElement("textarea");
            input.rows = 3;
            input.placeholder = "Lista de materiales utilizados separados por coma...";
          } else {
            input = document.createElement("input");
            
            if (campo === "numero" || campo === "precio") {
              input.type = "number";
              if (campo === "precio") {
                input.step = "0.01";
                input.min = "0";
                input.placeholder = "0.00";
              }
            } else if (campo === "fecha") {
              input.type = "date";
              // Establecer fecha m√°xima como hoy
              const hoy = new Date().toISOString().split('T')[0];
              input.max = hoy;
            } else {
              input.type = "text";
            }
          }

          input.name = campo;
          input.required = true;
          form.appendChild(label);
          form.appendChild(input);
        });

        // Informaci√≥n sobre las alertas
        const infoAlertas = document.createElement("div");
        infoAlertas.style.color = "#ffb84d";
        infoAlertas.style.fontSize = "0.9em";
        infoAlertas.style.marginTop = "10px";
        infoAlertas.innerHTML = "üí° El sistema alertar√° autom√°ticamente cuando un service cumpla 1 a√±o para contactar al cliente.";
        form.appendChild(infoAlertas);

        const boton = document.createElement("button");
        boton.textContent = "Guardar Service";
        boton.type = "submit";
        form.appendChild(boton);

        form.onsubmit = crearSubmitHandler("service");
      }

      // üîß Handler gen√©rico para submit
      function crearSubmitHandler(tabla) {
        return async (e) => {
          e.preventDefault();
          const datos = Object.fromEntries(new FormData(form).entries());
          
          // Validar campos vac√≠os
          for (const campo in datos) {
            if (datos[campo].trim() === "") {
              alert("Todos los campos son obligatorios");
              return;
            }
          }

          // Validaciones espec√≠ficas por tabla
          const erroresValidacion = validarDatos(tabla, datos);
          if (erroresValidacion.length > 0) {
            alert("Errores de validaci√≥n:\n\n" + erroresValidacion.join("\n"));
            return;
          }

          // Convertir campos num√©ricos
          if (datos.numero) datos.numero = parseInt(datos.numero);
          if (datos.precio) datos.precio = parseFloat(datos.precio);
          if (datos.mecanico) datos.mecanico = parseInt(datos.mecanico);

          const tablaReal = tablaMap[tabla].name;
          
          if (editando && registroEditando) {
            // Modo edici√≥n
            const pk = tablaMap[tabla].pk;
            const id = registroEditando[pk];
            
            console.log("Actualizando registro:", { tabla: tablaReal, pk, id, datos });
            
            const { error } = await supabase
              .from(tablaReal)
              .update(datos)
              .eq(pk, id);
            
            if (error) {
              console.error("Error al actualizar:", error);
              alert("Error al actualizar: " + error.message);
            } else {
              alert("Registro actualizado correctamente");
              form.reset();
              editando = false;
              registroEditando = null;
              const tituloForm = document.getElementById("titulo-form");
              tituloForm.textContent = "Agregar registro";
              container.querySelector('.table-container').innerHTML = "<p>Actualizando...</p>";
              await renderTablaConFiltros(tabla);
            }
          } else {
            // Modo inserci√≥n
            console.log("Insertando en tabla:", tablaReal, "Datos:", datos);
            
            const { error } = await supabase.from(tablaReal).insert([datos]);
            
            if (error) {
              console.error("Error al guardar:", error);
              alert("Error al guardar: " + error.message);
            } else {
              alert("Registro guardado correctamente");
              form.reset();
              container.querySelector('.table-container').innerHTML = "<p>Actualizando...</p>";
              await renderTablaConFiltros(tabla);
              
              // Si es un service nuevo, verificar alertas
              if (tabla === "service") {
                setTimeout(verificarAlertasServices, 1000);
              }
            }
          }
        };
      }

      // ‚úÖ Validaciones de datos
      function validarDatos(tabla, datos) {
        const errores = [];
        
        if (tabla === "service") {
          // Validar fecha no futura
          const fechaService = new Date(datos.fecha);
          const hoy = new Date();
          hoy.setHours(0, 0, 0, 0);
          
          if (fechaService > hoy) {
            errores.push("‚ùå La fecha del service no puede ser futura");
          }
          
          // Validar fecha no muy antigua (m√°s de 2 a√±os)
          const dosAniosAtras = new Date();
          dosAniosAtras.setFullYear(dosAniosAtras.getFullYear() - 2);
          
          if (fechaService < dosAniosAtras) {
            errores.push("‚ùå La fecha del service no puede ser de hace m√°s de 2 a√±os");
          }
          
          // Validar precio positivo
          if (datos.precio && parseFloat(datos.precio) <= 0) {
            errores.push("‚ùå El precio debe ser mayor a 0");
          }
          
          // Validar n√∫mero de contacto
          if (datos.numero && datos.numero.length < 8) {
            errores.push("‚ùå El n√∫mero de contacto debe tener al menos 8 d√≠gitos");
          }
          
          // Validar que el n√∫mero sea num√©rico
          if (datos.numero && isNaN(datos.numero)) {
            errores.push("‚ùå El n√∫mero de contacto debe contener solo d√≠gitos");
          }
        }
        
        return errores;
      }

      // ‚úèÔ∏è Funci√≥n para editar registro
      async function editarRegistro(tabla, id) {
        try {
          const tablaReal = tablaMap[tabla].name;
          const pk = tablaMap[tabla].pk;
          
          console.log("Editando registro:", { tabla, id, pk });
          
          // Obtener el registro completo desde la base de datos
          const { data, error } = await supabase
            .from(tablaReal)
            .select("*")
            .eq(pk, id)
            .single();
          
          if (error) {
            console.error("Error al obtener registro:", error);
            alert("Error al cargar registro: " + error.message);
            return;
          }
          
          if (!data) {
            alert("Registro no encontrado");
            return;
          }
          
          editando = true;
          registroEditando = data;
          tablaActual = tabla;
          
          const tituloForm = document.getElementById("titulo-form");
          tituloForm.textContent = "Editando registro";
          
          // Renderizar formulario espec√≠fico para edici√≥n
          if (tabla === "clientes") {
            await renderFormularioClientesEdicion(data);
          } else if (tabla === "mecanico") {
            await renderFormularioMecanicoEdicion(data);
          } else if (tabla === "service") {
            await renderFormularioServiceEdicion(data);
          } else {
            await renderFormularioNormalEdicion(tabla, data);
          }
          
          // Scroll al formulario
          form.scrollIntoView({ behavior: 'smooth' });
          
        } catch (error) {
          console.error("Error en editarRegistro:", error);
          alert("Error al editar registro: " + error.message);
        }
      }

      // üìù Formulario de clientes para edici√≥n
      async function renderFormularioClientesEdicion(data) {
        // Obtener lista de mec√°nicos para el select
        const { data: mecanicos, error } = await supabase
          .from("mecanicos")
          .select("id_mec, nombre, especialidad")
          .order("nombre");

        if (error) {
          console.error("Error al cargar mec√°nicos:", error);
          alert("Error al cargar mec√°nicos: " + error.message);
          return;
        }

        form.innerHTML = "";

        // Campos del formulario de clientes
        const camposClientes = ["nombre", "vehiculo", "numero"];
        
        camposClientes.forEach(campo => {
          const label = document.createElement("label");
          label.textContent = campo.charAt(0).toUpperCase() + campo.slice(1);

          const input = document.createElement("input");
          input.name = campo;
          input.required = true;
          input.type = "text";
          input.value = data[campo] || "";

          form.appendChild(label);
          form.appendChild(input);
        });

        // Campo mec√°nico como select
        const labelMecanico = document.createElement("label");
        labelMecanico.textContent = "Mec√°nico";
        const selectMecanico = document.createElement("select");
        selectMecanico.name = "mecanico";
        selectMecanico.required = true;

        // Opciones de mec√°nicos con nombre y especialidad
        mecanicos.forEach(mec => {
          const option = document.createElement("option");
          option.value = mec.id_mec;
          option.textContent = `${mec.nombre} - ${mec.especialidad}`;
          // Seleccionar el mec√°nico actual
          if (mec.id_mec === data.mecanico) {
            option.selected = true;
          }
          selectMecanico.appendChild(option);
        });

        form.appendChild(labelMecanico);
        form.appendChild(selectMecanico);

        const boton = document.createElement("button");
        boton.textContent = "Actualizar";
        boton.type = "submit";
        form.appendChild(boton);

        form.onsubmit = crearSubmitHandler("clientes");
      }

      // üìù Formulario de mec√°nicos para edici√≥n
      async function renderFormularioMecanicoEdicion(data) {
        // Obtener lista de especialidades
        const { data: especialidades, error } = await supabase
          .from("especialidades")
          .select("especialidad")
          .order("especialidad");

        if (error) {
          console.error("Error al cargar especialidades:", error);
          alert("Error al cargar especialidades: " + error.message);
          return;
        }

        form.innerHTML = "";

        // Campos del formulario de mec√°nicos
        const camposMecanico = ["nombre", "telefono"];
        
        camposMecanico.forEach(campo => {
          const label = document.createElement("label");
          label.textContent = campo.charAt(0).toUpperCase() + campo.slice(1);

          const input = document.createElement("input");
          input.name = campo;
          input.required = true;
          input.type = "text";
          input.value = data[campo] || "";

          form.appendChild(label);
          form.appendChild(input);
        });

        // Campo especialidad como select
        const labelEspecialidad = document.createElement("label");
        labelEspecialidad.textContent = "Especialidad";
        const selectEspecialidad = document.createElement("select");
        selectEspecialidad.name = "especialidad";
        selectEspecialidad.required = true;

        // Opciones de especialidades
        especialidades.forEach(esp => {
          const option = document.createElement("option");
          option.value = esp.especialidad;
          option.textContent = esp.especialidad;
          // Seleccionar la especialidad actual
          if (esp.especialidad === data.especialidad) {
            option.selected = true;
          }
          selectEspecialidad.appendChild(option);
        });

        form.appendChild(labelEspecialidad);
        form.appendChild(selectEspecialidad);

        const boton = document.createElement("button");
        boton.textContent = "Actualizar";
        boton.type = "submit";
        form.appendChild(boton);

        form.onsubmit = crearSubmitHandler("mecanico");
      }

      // üìù Formulario de service para edici√≥n
      async function renderFormularioServiceEdicion(data) {
        form.innerHTML = "";

        // Campos del formulario de service
        const camposService = ["nombre", "vehiculo", "numero", "precio", "materiales", "fecha"];
        
        camposService.forEach(campo => {
          const label = document.createElement("label");
          label.textContent = campo.charAt(0).toUpperCase() + campo.slice(1);

          let input;
          
          if (campo === "materiales") {
            input = document.createElement("textarea");
            input.rows = 3;
            input.placeholder = "Lista de materiales utilizados separados por coma...";
          } else {
            input = document.createElement("input");
            
            if (campo === "numero" || campo === "precio") {
              input.type = "number";
              if (campo === "precio") {
                input.step = "0.01";
                input.min = "0";
              }
            } else if (campo === "fecha") {
              input.type = "date";
              // Establecer fecha m√°xima como hoy
              const hoy = new Date().toISOString().split('T')[0];
              input.max = hoy;
            } else {
              input.type = "text";
            }
          }

          input.name = campo;
          input.required = true;

          if (data[campo] !== null && data[campo] !== undefined) {
            if (input.type === 'date' && data[campo]) {
              const fecha = new Date(data[campo]);
              input.value = fecha.toISOString().split('T')[0];
            } else {
              input.value = data[campo];
            }
          }

          form.appendChild(label);
          form.appendChild(input);
        });

        const boton = document.createElement("button");
        boton.textContent = "Actualizar";
        boton.type = "submit";
        form.appendChild(boton);

        form.onsubmit = crearSubmitHandler("service");
      }

      // üìù Formulario normal para edici√≥n
      async function renderFormularioNormalEdicion(tabla, data) {
        form.innerHTML = "";

        campos[tabla].forEach(campo => {
          const label = document.createElement("label");
          label.textContent = campo.charAt(0).toUpperCase() + campo.slice(1);

          const input = document.createElement("input");
          input.name = campo;
          input.required = true;
          
          if (campo === "numero" || campo === "precio") {
            input.type = "number";
            if (campo === "precio") {
              input.step = "0.01";
              input.min = "0";
            }
          } else if (campo === "fecha") {
            input.type = "date";
          } else if (campo === "materiales") {
            input.type = "text";
            input.placeholder = "Lista de materiales separados por coma";
          } else {
            input.type = "text";
          }

          if (data[campo] !== null && data[campo] !== undefined) {
            if (input.type === 'date' && data[campo]) {
              const fecha = new Date(data[campo]);
              input.value = fecha.toISOString().split('T')[0];
            } else {
              input.value = data[campo];
            }
          }

          form.appendChild(label);
          form.appendChild(input);
        });

        const boton = document.createElement("button");
        boton.textContent = "Actualizar";
        boton.type = "submit";
        form.appendChild(boton);

        form.onsubmit = crearSubmitHandler(tabla);
      }

      // üßæ Renderizar tabla con filtros
      async function renderTablaConFiltros(tabla) {
        try {
          const tablaReal = tablaMap[tabla].name;
          console.log("Cargando tabla:", tablaReal);
          
          let data;
          let error;

          // Caso especial para clientes - necesitamos unir con mec√°nicos
          if (tabla === "clientes") {
            const { data: clientesData, error: clientesError } = await supabase
              .from(tablaReal)
              .select(`
                *,
                mecanicos (
                  nombre,
                  especialidad
                )
              `);
            
            data = clientesData;
            error = clientesError;
          } else {
            const { data: tablaData, error: tablaError } = await supabase.from(tablaReal).select("*");
            data = tablaData;
            error = tablaError;
          }
          
          if (error) {
            console.error("Error al cargar datos:", error);
            container.querySelector('.table-container').innerHTML = `<p>Error al cargar datos: ${error.message}</p>`;
            return;
          }

          console.log("Datos recibidos:", data);

          // Guardar datos originales para filtrado
          datosOriginales[tabla] = data;

          // Aplicar filtros
          const datosFiltrados = filtrarDatos(tabla, data);

          if (!datosFiltrados || datosFiltrados.length === 0) {
            container.querySelector('.table-container').innerHTML = "<p>No hay registros que coincidan con los filtros.</p>";
            return;
          }

          let html = `<h2>${tabla.toUpperCase()}`;
          
          // Mostrar contador de resultados filtrados
          if (datosFiltrados.length !== data.length) {
            html += ` <span style="font-size: 0.7em; color: #ffb84d;">(${datosFiltrados.length} de ${data.length} registros)</span>`;
          }
          html += `</h2>`;
          
          html += `<table><thead><tr>`;
          
          // Encabezados de columnas - OCULTAR la columna "mecanico" y mostrar solo "Mec√°nico"
          for (const col in datosFiltrados[0]) {
            let nombreColumna = col;
            
            // Saltar la columna "mecanico" (ID) para clientes
            if (tabla === "clientes" && col === "mecanico") {
              continue;
            }
            
            // Renombrar columnas de ID
            if (col === "id_mec" || col === "id_cliente" || col === "id") {
              nombreColumna = "ID";
            } else if (col === "mecanicos") {
              nombreColumna = "Mec√°nico";
            }
            html += `<th>${nombreColumna}</th>`;
          }
          html += `<th>Acciones</th></tr></thead><tbody>`;

          // Filas de datos
          for (const row of datosFiltrados) {
            // Verificar si este service necesita alerta
            const necesitaAlerta = tabla === "service" && esServiceConAlerta(row.fecha);
            
            html += `<tr${necesitaAlerta ? ' class="alerta-service"' : ''}>`;
            for (const col in row) {
              let valor = row[col];
              
              // Saltar la columna "mecanico" (ID) para clientes
              if (tabla === "clientes" && col === "mecanico") {
                continue;
              }
              
              // Mostrar nombre y especialidad del mec√°nico
              if (col === "mecanicos" && tabla === "clientes" && row.mecanicos) {
                valor = `${row.mecanicos.nombre} - ${row.mecanicos.especialidad}`;
              }
              // Formatear fecha
              else if (col === "fecha" && valor) {
                valor = new Date(valor).toLocaleDateString('es-ES');
              }
              // Formatear precio
              else if (col === "precio" && valor) {
                valor = `$${parseFloat(valor).toFixed(2)}`;
              }
              // Manejar valores null o undefined
              else if (valor === null || valor === undefined) {
                valor = "";
              }
              // Si es el objeto mecanicos, mostrar el valor formateado
              else if (col === "mecanicos") {
                continue; // Ya lo mostramos arriba
              }
              
              html += `<td>${valor}</td>`;
            }
            
            // Botones de acciones
            const pk = tablaMap[tabla].pk;
            const pkValue = row[pk];
            
            html += `<td class="acciones-cell">`;
            
            // Bot√≥n editar
            if (tabla === "mecanico" || tabla === "clientes" || tabla === "service") {
              html += `<button class="btn-accion" onclick="editarRegistro('${tabla}', ${pkValue})">‚úèÔ∏è Editar</button>`;
            }
            
            // Bot√≥n eliminar
            if (tabla === "especialidad") {
              html += `<button class="btn-accion eliminar" onclick="borrar('${tabla}', '${pkValue}')">üóëÔ∏è Eliminar</button>`;
            } else {
              html += `<button class="btn-accion eliminar" onclick="borrar('${tabla}', ${pkValue})">üóëÔ∏è Eliminar</button>`;
            }
            
            html += `</td></tr>`;
          }

          html += `</tbody></table>`;
          
          // Agregar informaci√≥n sobre las alertas si es la tabla de services
          if (tabla === "service") {
            const servicesConAlerta = datosFiltrados.filter(row => esServiceConAlerta(row.fecha));
            if (servicesConAlerta.length > 0) {
              html += `<div style="margin-top: 20px; padding: 15px; background: #ff4444; color: white; border-radius: 8px; border-left: 5px solid #ff9800;">
                <strong>üö® ALERTA:</strong> ${servicesConAlerta.length} service(s) en rojo cumplen o est√°n por cumplir 1 a√±o. Contactar a los clientes.
              </div>`;
            }
          }
          
          container.querySelector('.table-container').innerHTML = html;
          
        } catch (error) {
          console.error("Error en renderTabla:", error);
          container.querySelector('.table-container').innerHTML = `<p>Error al renderizar la tabla: ${error.message}</p>`;
        }
      }

      // Funci√≥n auxiliar para determinar si un service necesita alerta
      function esServiceConAlerta(fechaService) {
        if (!fechaService) return false;
        
        const hoy = new Date();
        const fecha = new Date(fechaService);
        const diferenciaMs = hoy - fecha;
        const diferenciaDias = diferenciaMs / (1000 * 60 * 60 * 24);
        
        return diferenciaDias >= 360 && diferenciaDias <= 370;
      }

      // üóëÔ∏è Eliminar registro
      async function borrar(tabla, valor) {
        if (!confirm("¬øEliminar registro?")) return;
        
        try {
          const tablaReal = tablaMap[tabla].name;
          const pk = tablaMap[tabla].pk;
          
          console.log(`Eliminando de ${tablaReal} donde ${pk} = ${valor}`);
          
          const { error } = await supabase.from(tablaReal).delete().eq(pk, valor);
          
          if (error) {
            console.error("Error al eliminar:", error);
            alert("Error al eliminar: " + error.message);
          } else {
            alert("Registro eliminado correctamente");
            await renderTablaConFiltros(tabla);
          }
        } catch (error) {
          console.error("Error en borrar:", error);
          alert("Error al eliminar: " + error.message);
        }
      }

      // Iniciar sistema de alertas autom√°ticas
      function iniciarSistemaAlertas() {
        // Verificar cada 12 horas
        intervaloAlertas = setInterval(verificarAlertasServices, 12 * 60 * 60 * 1000);
      }

      // üìÇ Eventos
      selector.addEventListener("change", (e) => {
        tablaActual = e.target.value;
        renderFormulario(tablaActual);
        renderTablaConFiltros(tablaActual);
      });

      // Inicializar el sistema de gesti√≥n
      tablaActual = selector.value;
      renderFormulario(tablaActual);
      renderTablaConFiltros(tablaActual);
      
      // Iniciar sistema de alertas autom√°ticas
      iniciarSistemaAlertas();

      // Hacer las funciones globales para los botones
      window.editarRegistro = editarRegistro;
      window.borrar = borrar;
      window.cerrarModal = cerrarModal;
      window.verificarAlertasServices = verificarAlertasServices;
      window.aplicarFiltros = aplicarFiltros;
      window.limpiarFiltros = limpiarFiltros;
      window.renderTablaConFiltros = renderTablaConFiltros;
    }
  </script>
</body>
</html>